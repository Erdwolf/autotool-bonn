###################################################################
# TODO (Alf): das folgende noch nötig?
###################################################################

#
# enthält absolute Pfadangaben --> erlaube Überschreibung durch andere Makefiles
# (besonders aus anderen Verzeichnissen), dazu z.B. in ./control/Makefile
#
# RELATIV_TO_MAIN_DIR=..
# DIRS = $(RELATIV_TO_MAIN_DIR)/wash
# include ../Makefile-defs, 
# 
# 
ifndef RELATIV_TO_MAIN_DIR
RELATIV_TO_MAIN_DIR =.
endif


# erlaube überschreibung, s.o
ifndef DIRS
# DIRS = util:wash:control:bridge:challenger:ws03/aus:
DIRS = control
endif

#################################################################


FLAGS = -fallow-overlapping-instances \
	-fglasgow-exts \
	-fallow-undecidable-instances 

# PACKS = -package text -package data -package posix -package network 
# PACKS = -package Autolib

OPT = -O2 -fvia-C -funbox-strict-fields -fnumbers-strict # -fdicts-strict

# PROF = -prof -auto-all -auto-dicts

WARN =  -Werror -dcore-lint

# für HSQL version 1.4
ifeq ($(HSQL),1.4)
	DEFINES = -cpp -DHSQL14
else
	DEFINES = -cpp
endif

GHC_COMMAND = $(GHC) --make \
	$(WARN) $(OPT) $(PROF) $(PACKS) $(FLAGS) $(DEFINES) -i$(DIRS)

GHCI_COMMAND = 	$(GHC) --interactive \
	$(WARN) $(PACKS) $(FLAGS) $(DEFINES) -i$(DIRS)

all:

#########################################################################
# Implicit rules
#########################################################################

# build haskell-cgis, we need hsql stuff too 
%.cgi : do %.hs
	$(GHC_COMMAND)  $(EXTRA_PACKS)  $*.hs -o $@


#########################################################################
# cvs shorthands
#########################################################################

cvs-update:
	cvs update -d 2>&1 | tee cvs.log
	make drift

cvs-update-log: 
	cat cvs.log | grep -E '^[A-Z] '

cvs-status:
	cvs status 2>&1 | grep "File:" | grep -v "Up-to-date"
